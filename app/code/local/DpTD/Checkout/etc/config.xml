<?xml version="1.0" encoding="UTF-8"?>
<config>
  <modules>
    <DpTD_Checkout>
      <version>0.1.0</version>
    </DpTD_Checkout>
  </modules>
  <global>    
    <blocks> 
      <dptd_checkout>
        <class>DpTD_Checkout_Block</class>
      </dptd_checkout>
    </blocks>
    <helpers>
      <dptd_checkout>
        <class>DpTD_Checkout_Helper</class>
      </dptd_checkout>
      <checkout>
        <rewrite>
          <data>DpTD_Checkout_Helper_Data</data>
        </rewrite>
      </checkout>
    </helpers>
    <models>
      <dptd_checkout>
        <class>DpTD_Checkout_Model</class>
      </dptd_checkout>
    </models>
    <resources>
      <dptd_checkout_setup>
        <setup>
          <module>DpTD_Checkout</module>
          <class>DpTD_Checkout_Model_Resource_Setup</class>
          <connection>
            <use>core_setup</use>
          </connection>
        </setup>
      </dptd_checkout_setup>
    </resources>
    <fieldsets>
      <sales_convert_quote>
        <require_invoice>
          <to_order>*</to_order>
        </require_invoice>
      </sales_convert_quote>
      <sales_convert_order>
        <require_invoice>
          <to_quote>*</to_quote>
        </require_invoice>
      </sales_convert_order>
      <checkout_onepage_billing>
        <require_invoice>
          <to_quote>*</to_quote>
        </require_invoice>
      </checkout_onepage_billing>
    </fieldsets>
  </global>
  <frontend>    
    <layout>
      <updates>
        <dptd_checkout>
          <file>dptd_checkout.xml</file>
        </dptd_checkout>
      </updates>
    </layout>
    
    <events>
      <controller_action_postdispatch_checkout_onepage_saveBilling>
        <observers>
          <setInvoiceRequest>
            <type>singleton</type>
            <class>dptd_checkout/observer</class>
            <method>setInvoiceRequest</method>
          </setInvoiceRequest>
        </observers>
      </controller_action_postdispatch_checkout_onepage_saveBilling>
      
      <http_response_send_before>
        <observers>
          <ajaxcart_observer>
            <type>singleton</type>
            <class>dptd_checkout/observer</class>
            <method>onAjaxRequest</method>
          </ajaxcart_observer>
        </observers>
      </http_response_send_before>
    </events>
    
    <routers>
      <checkout>
        <args>
          <modules>
            <DpTD_Checkout before="Mage_Checkout">DpTD_Checkout</DpTD_Checkout>
          </modules>
        </args>
      </checkout>
    </routers>
  </frontend>
  <adminhtml>
    <layout>
      <updates>
        <DpTD_Checkout>
          <file>dptd_checkout/sales.xml</file>
        </DpTD_Checkout>
      </updates>
    </layout>
    <translate>
      <modules>
        <DpTD_Checkout>
          <files>
            <default>DpTD_Checkout.csv</default>
          </files>
        </DpTD_Checkout>
      </modules>
    </translate>
    <events>
      <controller_action_layout_render_before_adminhtml_sales_order_grid>
        <observers>
          <add_require_invoice_column>
            <type>singleton</type>
            <class>dptd_checkout/observer</class>
            <method>addRequireInvoiceColumnToGrid</method>
          </add_require_invoice_column>
        </observers>
      </controller_action_layout_render_before_adminhtml_sales_order_grid>
      <controller_action_layout_render_before_adminhtml_sales_order_index>
        <observers>
          <add_require_invoice_column>
            <type>singleton</type>
            <class>dptd_checkout/observer</class>
            <method>addRequireInvoiceColumnToGrid</method>
          </add_require_invoice_column>
        </observers>
      </controller_action_layout_render_before_adminhtml_sales_order_index>
    </events>
  </adminhtml>
</config>